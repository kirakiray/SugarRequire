!function(t){"use strict";function n(){this._eves={}}function e(){var t=this;t._e=new n,t._funs=[],t._fCou=0,t._id=0,t.datas=[],t.errs=[],t._r=0,t._next=[],t._nCou=0,t._h=0}function r(){var t=this.init.apply(this,arguments);return t?t:void 0}var i="pending",a="fulfilled",o="rejected",u="fire",s=function(){},f=function(t){return Array.prototype.slice.call(t,0)},c=function(t){return Object.prototype.toString.call(t).toLowerCase().replace(/(\[object )|(])/g,"")},p=function(){return[].forEach?function(t,n){return t.forEach(n)}:function(t,n){for(var e=0,r=t.length;r>e;e++)n(t[e],e)}}(),l=function(t,n){for(var e in n)t[e]=n[e];return t},h=function(){var t=!1,n=[];return function(e){t||(t=!0,setTimeout(function(){for(var e=0;e<n.length;e++)n[e]();n=[],t=!1},0)),n.push(e)}}(),d=function(t){var n=t.match(/(.+\/).+/);return n&&n[1]},_=function(t){var n=t.split(/\//g),e=[];return p(n,function(t){return".."==t&&e.length&&".."!=e.slice(-1)[0]?void e.pop():void e.push(t)}),e.join("/")};n.fn=n.prototype,n.prototype={_get:function(t){return this._eves[t]||(this._eves[t]={e:[],o:[]})},on:function(t,n){this._get(t).e.push(n)},one:function(t,n){this._get(t).o.push(n)},last:function(t,n){this._get(t).l=n},off:function(t){delete this._eves[t]},emit:function(t,n){for(var e=this._get(t),r=e.o;r.length;)r.shift()({name:t,type:"one"},n);p(e.e,function(e){e({name:t,type:"on"},n)});var i=e.l;i&&i({name:t,type:"last"},n),delete e.l}},e.prototype={_run:function(){var t=this;t._r=1,t._e.last(a,function(){t._next.length?t._h||p(t._next,function(t){t._run()}):t._e.emit(u)}),0 in t._funs?p(t._funs,function(t){t()}):t._e.emit(a),t._run=t._funs=null},_cp:function(t,n,e){var r=this,u=r._e;u.emit(i,{data:t,state:n,no:e}),--r._fCou||(u.emit(0 in r.errs?o:a),u.off(i),u.off(o),u.off(a),r.errs=r.datas=null)},add:function(t){var n=this;n._fCou++;var e=n._id++,r=0,i=function(){t.call(n,function(t){r||(r=1,n.datas[e]=t,n._cp(t,a,e))},function(t){r||(r=1,n.errs.push({no:e,data:t}),n._cp(t,o,e))})};n._r?i():n._funs.push(i)},then:function(t){var n=this;return n._e.one(a,function(){t.apply(n,n.datas)}),n},"catch":function(t){var n=this.errs;return this._e.one(o,function(){t(n)}),this},pend:function(t){return this._e.on(i,function(n,e){t(e)}),this},prom:function(){var t=new e;p(f(arguments),function(n){t.add(n)});var n=this;return n._nCou++,n._next.push(t),t._e.last(u,function(){--n._nCou||(n._e.emit(u),n._e=n._next=null)}),t},send:function(t){return this.data=t,this},gift:function(t){p(this._next,function(n){n.send(t)})},fire:function(t){return this._e.one(u,t),this},lock:function(){this._h=1},unlock:function(){var t=this;t._h&&(t._h=0,t.datas||t._next&&p(t._next,function(t){t._run()}))}};var v=function(){var t=new e;return p(f(arguments),function(n){t.add(n)}),h(function(){t._run()}),t},m=t.Promise;r.fn=r.prototype,r.fn.init=function(n,e,r){this._args=n,this._pub=e||{};var i=D.toProm(n,this);this._p=r?r.prom.apply(r,i):v.apply(t,i)},r.fn.require=function(){var t=new r(f(arguments),this._pub,this._p);return t},r.fn.pend=function(t){var n=this;return n._p.pend(function(e){var r;r=e.state!=a?l({val:n._args[e.no],no:e.no},e.data):l({val:n._args[e.no]},e),t.call(n,r)}),n},r.fn.fail=function(t){var n=this;return n._p["catch"](function(n){var e=[];p(n,function(t){e.push(l({no:t.no},t.data))}),t(e)}),n},r.fn.done=function(t){var n=this;return n._p.then(function(){var e=t.apply(n,arguments);if(e&&m&&e instanceof m){var r=n._pa;r||(n._p.lock(),r=n._pa=[],h(function(){m.all.call(m,r).then(function(){n._p.unlock()})})),r.push(e)}}),n},r.fn.post=function(t){return this._p.send(t),this},r.fn.hand=function(t){return this._p.gift(t),this};var g=function(){var t=new r(f(arguments));return t},y="define",b="defer",w="loading",x="loaded",k="finish",j="error",C=document.head,M={},P={},E={},q={paths:M,dirpaths:P,baseUrl:"",dataMap:E,tempM:{}},D={toProm:function(t,n){var e=[];return p(t,function(t){var r=D.getPath(t,n);e.push(D.agent(r,n))}),e},getPath:function(t,n){if(M[t])t=M[t];else{var e,r;for(var i in P)if(e=new RegExp("^"+i),r=e.test(t)){t=t.replace(e,P[i]);break}}if(!/^.+?\/\//.test(t)){/\?.+$/.test(t)||/.js$/.test(t)||(t+=".js");var a=t.match(/^\.\/(.+)/);t=a?d(n._pub.rel)+a[1]:q.baseUrl+t,t=_(t)}return t},agent:function(t,n){return function(e,r){var i=E[t];if(!i){var a=[];i=E[t]={state:w,proms:a},i.script=D.loadScript(t,function(){var n=q.tempM,e=n.type||"file";switch(i.type=e,i.state=x,e){case y:D.setDefine(t,function(t){i.state=k,p(a,function(n){n.res(t)}),delete i.proms});break;case b:i.state=k;{i.m=n.val}p(a,function(n){D.runDefer(t,n.d,n.res,n.rej)}),delete i.proms;break;default:i.state=k,p(a,function(t){t.res()}),delete i.proms}var r=n.ids;r&&("string"==c(r)?E[r]=i:"array"==c(r)&&p(r,function(t){E[t]=i})),q.tempM={}},function(){i.state=j,p(a,function(n){n.rej({state:j,url:t})}),S.error(t,n),q.tempM={}})}switch(i.state){case k:switch(i.type){case y:e(i.m);break;case b:D.runDefer(t,this.data,e,r);break;default:e()}break;case w:case x:i.proms.push({res:e,rej:r,d:this.data});break;case j:r()}}},loadScript:function(t,n,e){var r=document.createElement("script");return r.type="text/javascript",r.setAttribute("async",!0),r.onload=n,r.onerror=e,r.src=t,h(function(){C.appendChild(r)}),r},setDefine:function(t,n){var e,i=E[t],a=q.tempM,o=a.val;if("function"==c(o)){var u={},s={exports:u};e=g(),e._pub.rel=t;var p=!1,l=o.call({FILE:t},function(){var n,i=f(arguments);return n=p?new r(i,{rel:t}):e.require.apply(e,i)},u,s);l&&(s.exports=l),p=!0,e._p.fire(function(){var t=s.exports;i.m=t,n(t)})}else i.m=o,n(o);return e},runDefer:function(t,n,e,i){var a=E[t],u=a.m;u.call({FILE:t,data:n},function(){return new r(f(arguments),{rel:t})},e,function(n){i({state:o,data:n,url:t})})},define:function(t,n){q.tempM={type:y,val:t,ids:n}},defer:function(t,n){q.tempM={type:b,val:t,ids:n}}},U=function(t,n){D.define.call(D,t,n)},L=function(t,n){D.defer.call(D,t,n)},S={config:function(t){q.baseUrl=t.baseUrl||"";for(var n in t.paths)/\/$/.test(n)?P[n]=t.paths[n]:M[n]=t.paths[n]},require:g,define:U,defer:L,use:function(t){var n=D.getPath(t),e=E[n]||{},r=e.type;return r==y?e.m:r},remove:function(t){var n=D.getPath(t),e=E[n];return e?(delete E[n],!0):void 0},extend:function(t){t(q,D,r)},error:s,version:"3.1"},$=t.sr;if($){var A=$.config;A&&S.config(A);var F=$.ready;F&&h(F)}t.require||(t.require=g),t.define||(t.define=U),t.defer||(t.defer=L),t.sr=S}(window);